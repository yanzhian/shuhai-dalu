<form class="{{cssClass}}" autocomplete="off">
  <div class="item-card-container">

    {{!-- 编辑锁（独立一排） --}}
    <div class="item-card-lock-row">
      <button type="button" class="item-card-lock {{#if isLocked}}locked{{/if}}" title="{{#if isLocked}}解锁编辑{{else}}锁定编辑{{/if}}">
        <i class="fas {{#if isLocked}}fa-lock{{else}}fa-lock-open{{/if}}"></i>
      </button>
    </div>

    {{!-- 基础信息区域 --}}
    <div class="item-card-basic-info">
      {{!-- 左侧大图标 --}}
      <div class="item-card-icon-large">
        <img src="{{item.img}}" alt="{{item.name}}" data-edit="img" />
      </div>

      {{!-- 右侧信息：上中下布局 --}}
      <div class="item-card-info-right">
        {{!-- 上：名称 --}}
        <input name="name" type="text" value="{{item.name}}" placeholder="物品名称" class="item-card-name-input" {{#if isLocked}}disabled{{/if}} />

        {{!-- 中：类型（只读）、分类 --}}
        <div class="item-card-type-category-row">
          <span class="item-card-type-label">{{item.type}}</span>
          <span class="item-card-separator">-</span>
          <input name="system.category" type="text" value="{{system.category}}" placeholder="分类" class="item-card-category-input" {{#if isLocked}}disabled{{/if}} />
        </div>

        {{!-- 下：标签 --}}
        <input name="system.tags" type="text" value="{{system.tags}}" placeholder="[标签1][标签2]" class="item-card-tags-input" {{#if isLocked}}disabled{{/if}} />
      </div>
    </div>

    {{!-- 分割线 --}}
    <div class="item-card-divider"></div>

    {{!-- 属性行（上下两行布局） --}}
    <div class="item-card-properties-section">
      {{!-- 上行：骰数、费用、星光 --}}
      <div class="item-card-properties-row">
        <div class="item-card-prop-item">
          <i class="fas fa-dice-d6"></i>
          <input name="system.diceFormula" type="text" value="{{system.diceFormula}}" placeholder="3D6+4" {{#if isLocked}}disabled{{/if}} />
        </div>
        <div class="item-card-prop-item">
          <i class="fas fa-coins"></i>
          <span class="prop-label">Cost :</span>
          <input name="system.cost" type="text" value="{{system.cost}}" placeholder="6" {{#if isLocked}}disabled{{/if}} />
        </div>
        <div class="item-card-prop-item">
          <i class="fas fa-star"></i>
          <input name="system.starlightCost" type="number" value="{{system.starlightCost}}" placeholder="5" {{#if isLocked}}disabled{{/if}} />
        </div>
      </div>

      {{!-- 下行：防具属性（如果item.type是armor则显示） --}}
      {{#if (eq item.type "armor")}}
        <div class="item-card-armor-row">
          <span class="armor-label">防具属性：</span>
          <div class="item-card-armor-badges">
            {{#if system.armorProperties.slashUp}}<span class="armor-badge resist">斩击↑</span>{{/if}}
            {{#if system.armorProperties.pierceUp}}<span class="armor-badge resist">突刺↑</span>{{/if}}
            {{#if system.armorProperties.bluntUp}}<span class="armor-badge resist">打击↑</span>{{/if}}
            {{#if system.armorProperties.slashDown}}<span class="armor-badge weak">斩击↓</span>{{/if}}
            {{#if system.armorProperties.pierceDown}}<span class="armor-badge weak">突刺↓</span>{{/if}}
            {{#if system.armorProperties.bluntDown}}<span class="armor-badge weak">打击↓</span>{{/if}}
          </div>
        </div>
      {{/if}}
    </div>

    {{!-- 分割线 --}}
    <div class="item-card-divider"></div>

    {{!-- 标签页 --}}
    <div class="item-card-tabs">
      <div class="item-card-tab active" data-tab="effect">效果描述</div>
      <div class="item-card-tab" data-tab="conditions">条件触发</div>
    </div>

    {{!-- 效果描述标签页 --}}
    <div class="item-card-tab-content active" data-tab="effect">
      <div class="item-card-effect-panel">
        <div class="item-card-panel-header">
          <i class="fas fa-chevron-down collapse-icon"></i>
          <span class="panel-title">效果</span>
          {{#unless isLocked}}
            <button type="button" class="panel-edit-btn" title="编辑描述">
              <i class="fas fa-edit"></i>
            </button>
          {{/unless}}
        </div>
        <div class="item-card-panel-content">
          {{#if isLocked}}
            <div class="effect-display">{{{enrichedEffect}}}</div>
          {{else}}
            <textarea name="system.effect" class="effect-textarea">{{system.effect}}</textarea>
          {{/if}}
        </div>
      </div>
    </div>

    {{!-- 条件触发标签页 --}}
    <div class="item-card-tab-content" data-tab="conditions">
      <div class="item-card-conditions-list">
        {{#each system.conditions as |condition index|}}
          <div class="item-card-condition-panel" data-index="{{index}}">
            <div class="item-card-panel-header">
              <i class="fas fa-chevron-right collapse-icon"></i>
              <span class="panel-title">条件{{add index 1}}</span>
              <div class="panel-actions">
                {{#unless ../isLocked}}
                  <button type="button" class="panel-action-btn delete-condition-btn" title="删除条件">
                    <i class="fas fa-trash"></i>
                  </button>
                {{/unless}}
              </div>
            </div>
            <div class="item-card-panel-content collapsed">
              {{> systems/shuhai-dalu/templates/item-card/condition-editor.hbs condition=condition index=index locked=../isLocked buffPresets=../buffPresets}}
            </div>
          </div>
        {{/each}}
      </div>

      {{#unless isLocked}}
        <button type="button" class="item-card-add-condition-btn">
          <i class="fas fa-plus"></i>
          添加条件触发
        </button>
      {{/unless}}
    </div>

    {{!-- 底部按钮 --}}
    <div class="item-card-footer-actions">
      <button type="button" class="item-card-action-btn secondary item-chat-btn">
        <i class="fas fa-comment"></i>
        发送到聊天
      </button>
      <button type="button" class="item-card-action-btn item-use-btn">
        <i class="fas fa-hand-sparkles"></i>
        使用物品
      </button>
    </div>

  </div>
</form>
