{{!-- 对抗结果聊天卡片 --}}
<div class="counter-result-card" style="background: #0F0D1B; border: 2px solid #EBBD68; border-radius: 8px; padding: 16px; color: #EBBD68; font-family: 'Noto Sans SC', sans-serif;">

  {{!-- 第一部分：玩家对抗结果信息 --}}
  <div class="contest-display" style="display: flex; align-items: center; justify-content: center; gap: 24px; padding: 16px 0; border-bottom: 2px solid #EBBD68; margin-bottom: 16px;">

    {{!-- 左侧：发起人 --}}
    <div class="participant initiator" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
      <div class="participant-name" style="font-size: 16px; font-weight: bold; color: {{#if (gt initiatorResult counterResult)}}#EBBD68{{else if (lt initiatorResult counterResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{initiatorName}}</div>

      {{!-- 战斗骰卡片 --}}
      <div class="dice-card" style="position: relative; width: 75px; height: 75px; border: 2px solid {{#if (gt initiatorResult counterResult)}}#EBBD68{{else if (lt initiatorResult counterResult)}}#cf4646{{else}}#EBBD68{{/if}}; border-radius: 6px; background: transparent; display: flex; align-items: center; justify-content: center;">
        <img src="{{initiatorDiceImg}}" alt="{{initiatorDiceName}}" style="width: 100%; height: 100%; object-fit: contain; padding: 4px;" />

        {{!-- 左上角费用 --}}
        <div class="dice-cost" style="position: absolute; top: -4px; left: -4px; width: 20px; height: 20px; background: #E1AA43; color: #0F0D1B; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
          {{initiatorDiceCost}}
        </div>

        {{!-- 右下角骰数 --}}
        <div class="dice-count" style="position: absolute; bottom: -4px; right: -4px; padding: 2px 6px; background: #E1AA43; color: #0F0D1B; border-radius: 4px; font-size: 11px; font-weight: bold;">
          {{initiatorDiceFormula}}
        </div>
      </div>

      <div class="dice-name" style="font-size: 13px; color: {{#if (gt initiatorResult counterResult)}}#f3c267{{else if (lt initiatorResult counterResult)}}#cf4646{{else}}#f3c267{{/if}};">{{initiatorDiceName}}</div>
      <div class="dice-result" style="font-size: 18px; font-weight: bold; color: {{#if (gt initiatorResult counterResult)}}#EBBD68{{else if (lt initiatorResult counterResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{initiatorResult}}</div>
    </div>

    {{!-- 中间：对抗结果 --}}
    <div class="contest-vs" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
      <div class="vs-text" style="font-size: 32px; font-weight: bold; color: #EBBD68; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">VS</div>
      <div class="compare-symbol" style="font-size: 28px; font-weight: bold; color: #f3c267;">
        {{#if (gt initiatorResult counterResult)}}
          &gt;
        {{else if (lt initiatorResult counterResult)}}
          &lt;
        {{else}}
          =
        {{/if}}
      </div>
    </div>

    {{!-- 右侧：对抗者 --}}
    <div class="participant counter" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
      <div class="participant-name" style="font-size: 16px; font-weight: bold; color: {{#if (gt counterResult initiatorResult)}}#EBBD68{{else if (lt counterResult initiatorResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{counterName}}</div>

      {{!-- 战斗骰卡片 --}}
      <div class="dice-card" style="position: relative; width: 75px; height: 75px; border: 2px solid {{#if (gt counterResult initiatorResult)}}#EBBD68{{else if (lt counterResult initiatorResult)}}#cf4646{{else}}#EBBD68{{/if}}; border-radius: 6px; background: transparent; display: flex; align-items: center; justify-content: center;">
        <img src="{{counterDiceImg}}" alt="{{counterDiceName}}" style="width: 100%; height: 100%; object-fit: contain; padding: 4px;" />

        {{!-- 左上角费用 --}}
        <div class="dice-cost" style="position: absolute; top: -4px; left: -4px; width: 20px; height: 20px; background: #E1AA43; color: #0F0D1B; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
          {{counterDiceCost}}
        </div>

        {{!-- 右下角骰数 --}}
        <div class="dice-count" style="position: absolute; bottom: -4px; right: -4px; padding: 2px 6px; background: #E1AA43; color: #0F0D1B; border-radius: 4px; font-size: 11px; font-weight: bold;">
          {{counterDiceFormula}}
        </div>
      </div>

      <div class="dice-name" style="font-size: 13px; color: {{#if (gt counterResult initiatorResult)}}#f3c267{{else if (lt counterResult initiatorResult)}}#cf4646{{else}}#f3c267{{/if}};">{{counterDiceName}}</div>
      <div class="dice-result" style="font-size: 18px; font-weight: bold; color: {{#if (gt counterResult initiatorResult)}}#EBBD68{{else if (lt counterResult initiatorResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{counterResult}}</div>
    </div>

  </div>

  {{!-- 第二部分：对抗计算 --}}
  <div class="calculation-section" style="padding: 12px 0; border-bottom: 2px solid #EBBD68; margin-bottom: 12px;">
    <div class="calc-title" style="font-size: 14px; font-weight: bold; color: #EBBD68; margin-bottom: 8px; text-align: center;">对抗计算</div>

    <div class="calc-details" style="font-size: 13px; line-height: 1.8; text-align: center;">
      <div style="color: {{#if (gt initiatorResult counterResult)}}#EBBD68{{else if (lt initiatorResult counterResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{initiatorName}}: {{initiatorDiceRoll}} + {{initiatorBuff}} + {{initiatorAdjustment}} = {{initiatorResult}}</div>
      <div style="color: {{#if (gt counterResult initiatorResult)}}#EBBD68{{else if (lt counterResult initiatorResult)}}#cf4646{{else}}#EBBD68{{/if}};">{{counterName}}: {{counterDiceRoll}} + {{counterBuff}} + {{counterAdjustment}} = {{counterResult}}</div>
    </div>
  </div>

  {{!-- 第三部分：结果描述 --}}
  <div class="result-description" style="font-size: 13px; color: #EBBD68; line-height: 1.8; padding: 8px; background: rgba(235, 189, 104, 0.1); border-radius: 4px; margin-bottom: 12px;">
    {{{resultDescription}}}
  </div>

  {{!-- 扣除选中Token生命值按钮 --}}
  <div class="settle-section" style="text-align: center;">
    <button class="deduct-selected-token-hp-btn"
            data-final-damage="{{finalDamage}}"
            data-initiator-id="{{initiatorId}}"
            data-initiator-dice-id="{{initiatorDiceId}}"
            data-counter-id="{{counterId}}"
            data-counter-dice-id="{{counterDiceId}}"
            data-winner-id="{{winnerId}}"
            data-winner-dice-id="{{winnerDiceId}}"
            data-loser-id="{{loserId}}"
            style="padding: 10px 28px; background: #c14545; color: #FFFFFF; border: none; border-radius: 4px; font-size: 15px; font-weight: bold; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">
      扣除生命值
    </button>
    <div style="margin-top: 8px; font-size: 12px; color: #888;">
      先选中Token，再点击按钮扣除 <span style="color: #c14545; font-weight: bold;">{{finalDamage}}</span> 点生命值
    </div>
  </div>

</div>

<style>
.deduct-selected-token-hp-btn:hover {
  background: #d94545;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
}

.deduct-selected-token-hp-btn:active {
  transform: translateY(0);
}

.deduct-selected-token-hp-btn:disabled {
  background: #888;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}
</style>