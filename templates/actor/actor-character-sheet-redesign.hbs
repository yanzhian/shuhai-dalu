<form class="{{cssClass}} flexcol" autocomplete="off">

  {{!-- ==================== å›ºå®šé¡¶éƒ¨åŒºåŸŸ ==================== --}}
  <div class="fixed-header">

    {{!-- å·¦ä¾§ï¼šå¤´åƒå’Œç”Ÿå‘½å€¼ç­‰ä¿¡æ¯ --}}
    <div class="avatar-section">
      <div class="avatar-container">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
        <button class="lock-btn" title="é”å®šè§’è‰²è¡¨"><i class="fas fa-lock"></i></button>
      </div>

      {{!-- å¤´åƒä¸‹é¢çš„çŠ¶æ€ä¿¡æ¯ --}}
      <div class="status-info">
        {{!-- ç”Ÿå‘½å€¼ --}}
        <div class="status-box hp-box">
          <label>ç”Ÿå‘½å€¼</label>
          <div class="status-bar">
            <input type="number" name="system.derived.hp.value" value="{{system.derived.hp.value}}" data-dtype="Number" min="0"/>
            <span>/</span>
            <span class="max">{{system.derived.hp.max}}</span>
          </div>
          <div class="progress-bar hp">
            <div class="progress-fill" style="width: {{multiply (divide system.derived.hp.value system.derived.hp.max) 100}}%"></div>
          </div>
        </div>

        {{!-- ä¾µèš€å€¼ --}}
        <div class="status-box corruption-box">
          <label>ä¾µèš€å€¼</label>
          <div class="status-bar">
            <input type="number" name="system.derived.corruption.value" value="{{system.derived.corruption.value}}" data-dtype="Number" min="0"/>
            <span>/</span>
            <span class="max">{{system.derived.corruption.max}}</span>
          </div>
          <div class="progress-bar corruption">
            <div class="progress-fill" style="width: {{multiply (divide system.derived.corruption.value system.derived.corruption.max) 100}}%"></div>
          </div>
        </div>

        {{!-- æ··ä¹±æ¡ --}}
        <div class="status-box chaos-box">
          <label>æ··ä¹±æ¡</label>
          <div class="status-value">{{system.derived.chaos}}</div>
        </div>

        {{!-- ä¾µèš€é‰´å®šæŒ‰é’® --}}
        <button class="check-btn corruption-check-btn">
          <span class="check-dot"></span>
          ä¾µèš€é‰´å®š
        </button>

        {{!-- é•¿ä¼‘æŒ‰é’® --}}
        <button class="action-btn long-rest-btn">
          <i class="fas fa-bed"></i> é•¿ä¼‘
        </button>
      </div>
    </div>

    {{!-- å³ä¾§ï¼šåŸºç¡€ä¿¡æ¯å’Œå±æ€§ --}}
    <div class="info-attributes-section">

      {{!-- åŸºç¡€ä¿¡æ¯ --}}
      <div class="basic-info">
        <div class="info-item name-item">
          <label>åå­—</label>
          <input name="name" type="text" value="{{actor.name}}" placeholder="è§’è‰²åç§°"/>
        </div>
        <div class="info-item">
          <label>ç§æ—</label>
          <input type="text" name="system.info.race" value="{{system.info.race}}" placeholder="äººç±»"/>
        </div>
        <div class="info-item">
          <label>æ€§åˆ«</label>
          <input type="text" name="system.info.gender" value="{{system.info.gender}}" placeholder="æœªçŸ¥"/>
        </div>
        <div class="info-item">
          <label>åŠ¿åŠ›</label>
          <input type="text" name="system.info.faction" value="{{system.info.faction}}" placeholder=""/>
        </div>
        <div class="info-item">
          <label>ç»éªŒ</label>
          <input type="number" name="system.info.experience" value="{{system.info.experience}}" data-dtype="Number" min="0"/>
        </div>
        <div class="info-item">
          <label>ç­‰çº§</label>
          <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" min="1"/>
        </div>
      </div>

      {{!-- å±æ€§ä¿¡æ¯ --}}
      <div class="attributes-info">
        {{#each attributes as |attr key|}}
        <div class="attr-item" data-attribute="{{key}}">
          <label>{{attr.label}}</label>
          <input type="number" name="system.attributes.{{key}}" value="{{attr.value}}" data-dtype="Number" min="1" max="30"/>
          <button class="attr-check-btn" data-attribute="{{key}}" title="{{attr.label}}æ£€å®š">
            <span class="check-dot"></span>
          </button>
        </div>
        {{/each}}

        {{!-- æ˜Ÿå…‰æ•° --}}
        <div class="attr-item starlight-item">
          <label>æ˜Ÿå…‰æ•°</label>
          <div class="starlight-value">
            <span class="current">{{system.derived.starlight}}</span>
            <span>/</span>
            <span class="max">{{add 10 (multiply system.level 2)}}</span>
          </div>
        </div>

        {{!-- é€Ÿåº¦å€¼ --}}
        <div class="attr-item speed-item">
          <label>é€Ÿåº¦å€¼</label>
          <div class="speed-value">{{system.derived.speed}}</div>
          <button class="roll-speed-btn" title="æŠ•æ·é€Ÿåº¦">
            <i class="fas fa-dice"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  {{!-- ==================== æœç´¢ç³»ç»Ÿ ==================== --}}
  <div class="search-section">
    <input type="text" class="search-input" placeholder="æœç´¢ç‰©å“..." id="item-search"/>
    <button class="quick-filter-btn" data-filter="combat">æˆ˜æ–—éª°</button>
    <button class="quick-filter-btn" data-filter="defense">å®ˆå¤‡éª°</button>
    <button class="quick-filter-btn" data-filter="equipment">è£…å¤‡éª°</button>
  </div>

  {{!-- ==================== ä¸»å†…å®¹åŒºåŸŸï¼šå·¦å³åˆ†æ  ==================== --}}
  <div class="main-content">

    {{!-- å·¦ä¾§æ  --}}
    <div class="left-panel">

      {{!-- æŠ€èƒ½é‰´å®š --}}
      <div class="skills-section">
        <h3>æŠ€èƒ½é‰´å®š</h3>

        {{!-- åŠ›æ•æŠ€èƒ½ --}}
        <div class="skill-category">
          <div class="category-title">
            <span>åŠ›æ•æŠ€èƒ½</span>
            <span class="skill-points-info">
              å‰©ä½™: <strong>{{subtract system.skillPoints.strengthDex.total system.skillPoints.strengthDex.used}}</strong>
            </span>
          </div>
          <div class="skills-list">
            {{#each skillGroups.strengthDex as |skill key|}}
            <div class="skill-row">
              <label>{{skill.label}}</label>
              <div class="skill-controls">
                <button class="skill-decrease" data-skill="{{key}}" data-category="strengthDex">-</button>
                <input type="number" name="system.skills.{{key}}" value="{{skill.value}}" data-dtype="Number" min="0" max="25" readonly/>
                <button class="skill-increase" data-skill="{{key}}" data-category="strengthDex">+</button>
                <button class="skill-check-btn" data-skill="{{key}}" title="{{skill.label}}æ£€å®š">
                  <span class="check-dot"></span>
                </button>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- æ™ºåŠ›æŠ€èƒ½ --}}
        <div class="skill-category">
          <div class="category-title">
            <span>æ™ºåŠ›æŠ€èƒ½</span>
            <span class="skill-points-info">
              å‰©ä½™: <strong>{{subtract system.skillPoints.intelligence.total system.skillPoints.intelligence.used}}</strong>
            </span>
          </div>
          <div class="skills-list">
            {{#each skillGroups.intelligence as |skill key|}}
            <div class="skill-row">
              <label>{{skill.label}}</label>
              <div class="skill-controls">
                <button class="skill-decrease" data-skill="{{key}}" data-category="intelligence">-</button>
                <input type="number" name="system.skills.{{key}}" value="{{skill.value}}" data-dtype="Number" min="0" max="25" readonly/>
                <button class="skill-increase" data-skill="{{key}}" data-category="intelligence">+</button>
                <button class="skill-check-btn" data-skill="{{key}}" title="{{skill.label}}æ£€å®š">
                  <span class="check-dot"></span>
                </button>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- æ„ŸçŸ¥æŠ€èƒ½ --}}
        <div class="skill-category">
          <div class="category-title">
            <span>æ„ŸçŸ¥æŠ€èƒ½</span>
            <span class="skill-points-info">
              å‰©ä½™: <strong>{{subtract system.skillPoints.perception.total system.skillPoints.perception.used}}</strong>
            </span>
          </div>
          <div class="skills-list">
            {{#each skillGroups.perception as |skill key|}}
            <div class="skill-row">
              <label>{{skill.label}}</label>
              <div class="skill-controls">
                <button class="skill-decrease" data-skill="{{key}}" data-category="perception">-</button>
                <input type="number" name="system.skills.{{key}}" value="{{skill.value}}" data-dtype="Number" min="0" max="25" readonly/>
                <button class="skill-increase" data-skill="{{key}}" data-category="perception">+</button>
                <button class="skill-check-btn" data-skill="{{key}}" title="{{skill.label}}æ£€å®š">
                  <span class="check-dot"></span>
                </button>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- é­…åŠ›æŠ€èƒ½ --}}
        <div class="skill-category">
          <div class="category-title">
            <span>é­…åŠ›æŠ€èƒ½</span>
            <span class="skill-points-info">
              å‰©ä½™: <strong>{{subtract system.skillPoints.charisma.total system.skillPoints.charisma.used}}</strong>
            </span>
          </div>
          <div class="skills-list">
            {{#each skillGroups.charisma as |skill key|}}
            <div class="skill-row">
              <label>{{skill.label}}</label>
              <div class="skill-controls">
                <button class="skill-decrease" data-skill="{{key}}" data-category="charisma">-</button>
                <input type="number" name="system.skills.{{key}}" value="{{skill.value}}" data-dtype="Number" min="0" max="25" readonly/>
                <button class="skill-increase" data-skill="{{key}}" data-category="charisma">+</button>
                <button class="skill-check-btn" data-skill="{{key}}" title="{{skill.label}}æ£€å®š">
                  <span class="check-dot"></span>
                </button>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>

      {{!-- è£…å¤‡æ  --}}
      <div class="equipment-section">
        <h3>è£…å¤‡æ </h3>

        <div class="equipment-grid">
          {{!-- æ­¦å™¨æ§½ --}}
          <div class="equip-slot" data-slot="weapon">
            <label>ğŸ—¡ï¸ æ­¦å™¨</label>
            <div class="slot-content" data-slot-type="weapon">
              {{#if system.equipment.weapon}}
                <span class="equipped-item">{{getItemName system.equipment.weapon}}</span>
                <button class="unequip-btn" data-slot-type="weapon"><i class="fas fa-times"></i></button>
              {{else}}
                <span class="empty-text">æ‹–æ”¾è£…å¤‡</span>
              {{/if}}
            </div>
          </div>

          {{!-- é˜²å…·æ§½ --}}
          <div class="equip-slot" data-slot="armor">
            <label>ğŸ›¡ï¸ é˜²å…·</label>
            <div class="slot-content" data-slot-type="armor">
              {{#if system.equipment.armor}}
                <span class="equipped-item">{{getItemName system.equipment.armor}}</span>
                <button class="unequip-btn" data-slot-type="armor"><i class="fas fa-times"></i></button>
              {{else}}
                <span class="empty-text">æ‹–æ”¾è£…å¤‡</span>
              {{/if}}
            </div>
          </div>

          {{!-- æˆ˜æ–—éª°æ§½ä½ --}}
          {{#each system.equipment.combatDice as |diceId index|}}
          <div class="equip-slot dice-slot" data-slot="combatDice-{{index}}">
            <label>âš”ï¸ æˆ˜æ–—éª°{{add index 1}}</label>
            <div class="slot-content" data-slot-type="combatDice" data-slot-index="{{index}}">
              {{#if diceId}}
                <span class="equipped-item">{{getItemName diceId}}</span>
                <button class="use-dice-btn" data-item-id="{{diceId}}"><i class="fas fa-play"></i></button>
                <button class="unequip-btn" data-slot-type="combatDice" data-slot-index="{{index}}"><i class="fas fa-times"></i></button>
              {{else}}
                <span class="empty-text">æ‹–æ”¾éª°å­</span>
              {{/if}}
            </div>
          </div>
          {{/each}}

          {{!-- å®ˆå¤‡éª° --}}
          <div class="equip-slot dice-slot" data-slot="defenseDice">
            <label>ğŸ›¡ï¸ å®ˆå¤‡éª°</label>
            <div class="slot-content" data-slot-type="defenseDice">
              {{#if system.equipment.defenseDice}}
                <span class="equipped-item">{{getItemName system.equipment.defenseDice}}</span>
                <button class="use-dice-btn" data-item-id="{{system.equipment.defenseDice}}"><i class="fas fa-play"></i></button>
                <button class="unequip-btn" data-slot-type="defenseDice"><i class="fas fa-times"></i></button>
              {{else}}
                <span class="empty-text">æ‹–æ”¾éª°å­</span>
              {{/if}}
            </div>
          </div>
        </div>
      </div>

      {{!-- è´§å¸ --}}
      <div class="currency-section">
        <h3>è´§å¸</h3>
        <div class="currency-grid">
          <div class="currency-item">
            <label>ğŸ’° è´§å¸</label>
            <input type="number" name="system.resources.currency" value="{{system.resources.currency}}" data-dtype="Number" min="0"/>
          </div>
          <div class="currency-item">
            <label>ğŸ² å¥‡é‡ç‚¹</label>
            <input type="number" name="system.resources.encounterPoints" value="{{system.resources.encounterPoints}}" data-dtype="Number" min="0"/>
          </div>
          <div class="currency-item">
            <label>âœ¨ å¥‡è¿¹ç‚¹</label>
            <input type="number" name="system.resources.miraclePoints" value="{{system.resources.miraclePoints}}" data-dtype="Number" min="0"/>
          </div>
          <div class="currency-item">
            <label>ğŸ”® å¤åˆ¶æ ¸å¿ƒ</label>
            <input type="number" name="system.resources.replicaCore" value="{{system.resources.replicaCore}}" data-dtype="Number" min="0"/>
          </div>
        </div>
      </div>
    </div>

    {{!-- å³ä¾§æ ï¼šç‰©å“æ  --}}
    <div class="right-panel">
      <div class="inventory-section">
        <div class="inventory-header">
          <h3>ç‰©å“æ </h3>
          <button class="create-new-item-btn" title="åˆ›å»ºæ–°ç‰©å“">
            <i class="fas fa-plus"></i> åˆ›å»ºç‰©å“
          </button>
        </div>

        <div class="inventory-list" id="inventory-list">
          {{#each items as |item id|}}
          <div class="inventory-item" data-item-id="{{item._id}}" draggable="true">
            <img src="{{item.img}}" class="item-img" data-item-id="{{item._id}}" title="ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…"/>
            <div class="item-details">
              <div class="item-name">{{item.name}}</div>
              <div class="item-meta">
                <span class="item-type">{{item.type}}</span>
                {{#if item.system.quantity}}
                <span class="item-quantity">x{{item.system.quantity}}</span>
                {{/if}}
              </div>
            </div>
            <div class="item-actions">
              <button class="item-edit-btn" data-item-id="{{item._id}}" title="ç¼–è¾‘"><i class="fas fa-edit"></i></button>
              <button class="item-delete-btn" data-item-id="{{item._id}}" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</form>
