<form class="{{cssClass}} flexcol" autocomplete="off">
  {{!-- 编辑锁 --}}
  <div class="item-lock-row">
    <button type="button" class="item-lock-btn {{#if isLocked}}locked{{/if}}" title="{{#if isLocked}}解锁编辑{{else}}锁定编辑{{/if}}">
      <i class="fas fa-{{#if isLocked}}lock{{else}}lock-open{{/if}}"></i>
    </button>
  </div>

  {{!-- 基础信息区域 --}}
  <div class="item-basic-info">
    {{!-- 图标 --}}
    <div class="item-icon-section">
      <div class="item-icon-wrapper" data-edit="img" title="{{item.name}}">
        <img src="{{item.img}}" alt="{{item.name}}"/>
      </div>
    </div>

    {{!-- 信息 --}}
    <div class="item-info-section">
      {{!-- 名称 --}}
      <div class="item-name-row">
        <input name="name" type="text" value="{{item.name}}" placeholder="物品名称" {{#if isLocked}}disabled{{/if}}/>
      </div>

      {{!-- 类型和分类 --}}
      <div class="item-type-category-row">
        <div>
          <span style="font-size: 12px; color: #EBBD68;">类型: {{item.type}}</span>
        </div>
        <div>
          {{#if allowCustomCategory}}
          <input type="text" name="system.category" value="{{system.category}}" placeholder="分类" {{#if isLocked}}disabled{{/if}}/>
          {{else}}
          <select name="system.category" {{#if isLocked}}disabled{{/if}}>
            {{#each categories as |cat|}}
            <option value="{{cat.value}}" {{#if (eq ../system.category cat.value)}}selected{{/if}}>
              {{cat.label}}
            </option>
            {{/each}}
          </select>
          {{/if}}
        </div>
      </div>

      {{!-- 标签 --}}
      <div class="item-tags-row">
        <input type="text" name="system.tags" value="{{system.tags}}" placeholder="标签（逗号分隔）" {{#if isLocked}}disabled{{/if}}/>
      </div>
    </div>
  </div>

  {{!-- 属性信息区域 --}}
  <div class="item-properties-section">
    <div class="item-stats-row">
      {{!-- 骰数 --}}
      {{#if showDiceFormula}}
      <div class="item-stat-field">
        <label>骰数</label>
        <input type="text" name="system.diceFormula" value="{{system.diceFormula}}" placeholder="1d6+3" {{#if isLocked}}disabled{{/if}}/>
      </div>
      {{/if}}

      {{!-- 费用 --}}
      <div class="item-stat-field">
        <label>费用</label>
        <input type="text" name="system.cost" value="{{system.cost}}" placeholder="-" {{#if isLocked}}disabled{{/if}}/>
      </div>

      {{!-- 星光 --}}
      {{#if showStarlightCost}}
      <div class="item-stat-field">
        <label>星光</label>
        <input type="number" name="system.starlightCost" value="{{system.starlightCost}}" min="0" {{#if isLocked}}disabled{{/if}}/>
      </div>
      {{/if}}
    </div>

    {{!-- 防具属性 --}}
    {{#if showArmorProperties}}
    <div class="armor-properties-section">
      <div class="section-title">防具属性</div>
      <div class="armor-properties-grid">
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.slashUp" {{#if system.armorProperties.slashUp}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label resist">斩击↑</span>
        </label>
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.pierceUp" {{#if system.armorProperties.pierceUp}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label resist">突刺↑</span>
        </label>
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.bluntUp" {{#if system.armorProperties.bluntUp}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label resist">打击↑</span>
        </label>
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.slashDown" {{#if system.armorProperties.slashDown}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label weak">斩击↓</span>
        </label>
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.pierceDown" {{#if system.armorProperties.pierceDown}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label weak">突刺↓</span>
        </label>
        <label class="armor-property-item">
          <input type="checkbox" name="system.armorProperties.bluntDown" {{#if system.armorProperties.bluntDown}}checked{{/if}} {{#if isLocked}}disabled{{/if}}/>
          <span class="property-label weak">打击↓</span>
        </label>
      </div>
    </div>
    {{/if}}
  </div>

  {{!-- 标签页区域 --}}
  <div class="item-tabs-section">
    <nav class="item-tabs-nav">
      <button type="button" class="item-tab-btn active" data-tab="effect">效果描述</button>
      <button type="button" class="item-tab-btn" data-tab="conditions">条件触发</button>
    </nav>

    <div class="item-tabs-content">
      {{!-- 效果描述标签页 --}}
      <div class="item-tab-pane active" data-tab="effect">
        <div class="effect-description-section">
          <div class="effect-header">
            <button type="button" class="effect-toggle-btn" title="展开/折叠">
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="effect-title">效果</div>
            <button type="button" class="effect-edit-btn {{#unless isLocked}}active{{/unless}}" title="编辑描述">
              <i class="fas fa-pen"></i>
            </button>
          </div>
          <div class="effect-content">
            <textarea name="system.effect" placeholder="描述物品的效果..." {{#if isLocked}}disabled{{/if}}>{{system.effect}}</textarea>
          </div>
        </div>
      </div>

      {{!-- 条件触发标签页 --}}
      <div class="item-tab-pane" data-tab="conditions">
        <div class="conditions-list-section">
          {{#each system.conditions as |condition idx|}}
          <div class="condition-item" data-condition-id="{{condition.id}}" data-condition-idx="{{idx}}">
            <div class="condition-header">
              <button type="button" class="condition-toggle-btn" title="展开/折叠">
                <i class="fas fa-chevron-down"></i>
              </button>
              <input type="text" class="condition-name-input"
                     name="system.conditions.{{idx}}.name"
                     value="{{condition.name}}"
                     placeholder="条件名称"
                     {{#if ../isLocked}}disabled{{/if}}/>
              <div class="condition-actions">
                <button type="button" class="condition-action-btn delete-btn" title="删除" {{#if ../isLocked}}disabled{{/if}}>
                  <i class="fas fa-trash"></i>
                </button>
                <button type="button" class="condition-action-btn use-btn" title="使用">
                  <i class="fas fa-play"></i>
                </button>
              </div>
            </div>

            <div class="condition-content">
              {{!-- 触发时机 --}}
              <div class="condition-trigger-section">
                <div class="condition-section-title">触发时机</div>
                <div class="condition-trigger-options">
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onUse" {{#if (eq condition.trigger "onUse")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>使用时</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onAttack" {{#if (eq condition.trigger "onAttack")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>攻击时</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onCounter" {{#if (eq condition.trigger "onCounter")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>对抗时</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onCounterSuccess" {{#if (eq condition.trigger "onCounterSuccess")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>对抗成功</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onCounterFailure" {{#if (eq condition.trigger "onCounterFailure")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>对抗失败</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onHit" {{#if (eq condition.trigger "onHit")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>攻击命中</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onDamaged" {{#if (eq condition.trigger "onDamaged")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>受到伤害</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onTurnStart" {{#if (eq condition.trigger "onTurnStart")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>回合开始</span>
                  </label>
                  <label class="trigger-option">
                    <input type="radio" name="system.conditions.{{idx}}.trigger" value="onTurnEnd" {{#if (eq condition.trigger "onTurnEnd")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>回合结束</span>
                  </label>
                </div>
              </div>

              {{!-- 消耗 --}}
              <div class="condition-consumption-section">
                <div class="consumption-toggle">
                  <input type="checkbox" id="need-consumption-{{idx}}" name="system.conditions.{{idx}}.needConsumption" {{#if condition.needConsumption}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                  <label for="need-consumption-{{idx}}">需要消耗</label>
                </div>
                {{#if condition.needConsumption}}
                <div class="consumption-effects">
                  <div class="condition-section-title" style="width: 100%;">消耗效果（开发中）</div>
                </div>
                {{/if}}
              </div>

              {{!-- 目标 --}}
              <div class="condition-target-section">
                <div class="condition-section-title">目标</div>
                <div class="target-options">
                  <label class="target-option">
                    <input type="radio" name="system.conditions.{{idx}}.target" value="selected" {{#if (eq condition.target "selected")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>选择的目标</span>
                  </label>
                  <label class="target-option">
                    <input type="radio" name="system.conditions.{{idx}}.target" value="self" {{#if (eq condition.target "self")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>自己</span>
                  </label>
                  <label class="target-option">
                    <input type="radio" name="system.conditions.{{idx}}.target" value="multiple" {{#if (eq condition.target "multiple")}}checked{{/if}} {{#if ../isLocked}}disabled{{/if}}/>
                    <span>多个目标</span>
                  </label>
                </div>
              </div>

              {{!-- 基础效果 --}}
              <div class="condition-base-effects-section">
                <div class="condition-section-title">基础效果（多选）</div>
                <div class="base-effects-grid">
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="rupture"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "rupture")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>破裂</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="sinking"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "sinking")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>沉沦</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="bleeding"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "bleeding")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>流血</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="burn"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "burn")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>燃烧</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="breath"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "breath")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>呼吸</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="charge"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "charge")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>充能</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="tremor"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "tremor")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>震颤</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="moan"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "moan")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>呻吟</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="medicine"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "medicine")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>携药</span>
                  </label>
                  <label class="base-effect-option">
                    <input type="checkbox" class="base-effect-checkbox" value="paralysis"
                           data-condition-idx="{{idx}}"
                           {{#if (includes condition.baseEffects "paralysis")}}checked{{/if}}
                           {{#if ../isLocked}}disabled{{/if}}/>
                    <span>麻痹</span>
                  </label>
                </div>
              </div>

              {{!-- 其他效果 --}}
              <div class="condition-custom-effect-section">
                <div class="condition-section-title">其他效果（自定义）</div>
                <div class="custom-effect-fields">
                  <div class="custom-effect-field">
                    <label>效果名称</label>
                    <input type="text" name="system.conditions.{{idx}}.customEffect.name"
                           value="{{condition.customEffect.name}}"
                           placeholder="自定义效果"
                           {{#if ../isLocked}}disabled{{/if}}/>
                  </div>
                  <div class="custom-effect-field">
                    <label>层数</label>
                    <input type="number" name="system.conditions.{{idx}}.customEffect.layers"
                           value="{{condition.customEffect.layers}}"
                           min="0"
                           {{#if ../isLocked}}disabled{{/if}}/>
                  </div>
                  <div class="custom-effect-field">
                    <label>强度</label>
                    <input type="number" name="system.conditions.{{idx}}.customEffect.strength"
                           value="{{condition.customEffect.strength}}"
                           min="0"
                           {{#if ../isLocked}}disabled{{/if}}/>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}

          {{!-- 添加条件按钮 --}}
          <button type="button" class="add-condition-btn" {{#if isLocked}}disabled{{/if}}>
            <i class="fas fa-plus"></i>
            <span>添加条件触发</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</form>

{{!-- 引入CSS样式 --}}
<link rel="stylesheet" href="systems/shuhai-dalu/styles/item-sheet.css"/>
